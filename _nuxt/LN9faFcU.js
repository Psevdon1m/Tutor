import{e as D,f as G,g as j,h as v,r as _,i as U,j as C,c as h,o as g,F as x,a as c,k as P,n as B,l,t as w,m as q,p as O,b as z}from"./CBps6TGr.js";const S=()=>D().$supabase.client,$=G("userStore",{state:()=>({userPreferences:null,loading:!1,error:null}),actions:{async fetchUserPreferences(i){const e=S();this.loading=!0;try{const{data:n,error:t}=await e.from("user_preferences").select("*").eq("user_id",i);if(t)throw t;this.userPreferences=n[0]||null}catch(n){this.error=n instanceof Error?n.message:"Unknown error",console.error("Error loading user preferences:",n)}finally{this.loading=!1}}},getters:{getUserPreferences:i=>i.userPreferences||{subjects:[],notification_frequency:null}}}),H={class:"space-y-3 mb-12"},I=["onClick"],V=j({__name:"SubjectsList",props:{subjects:{}},emits:["toggle-subject"],setup(i,{emit:e}){const n=$(),t=v(()=>n.getUserPreferences),s=i,b=e,r=_([]);U(()=>{t.value&&(r.value=[...t.value.subjects])});const y=u=>{const a=r.value.indexOf(u);a===-1?r.value.push(u):r.value.splice(a,1);const f=s.subjects.find(p=>p.id===u);f&&b("toggle-subject",f)};return C(t,()=>{t.value&&r.value.length===0&&(r.value=[...t.value.subjects])}),(u,a)=>(g(),h(x,null,[a[0]||(a[0]=c("h2",{class:"text-2xl font-semibold text-[#2a3538] mb-4 font-montserrat"}," Subjects ",-1)),c("div",H,[s.subjects.length?(g(!0),h(x,{key:1},P(s.subjects,(f,p)=>(g(),h("button",{key:p,class:B(["w-full h-14 rounded-xl text-xl font-normal transition-opacity text-left pl-4",l(r).includes(f.id)?"bg-[#5e9f95] text-white":"bg-[#b1d1b1] text-[#062431]"]),onClick:E=>y(f.id)},w(f.name),11,I))),128)):(g(),h(x,{key:0},P(4,f=>c("div",{key:f,class:"w-full h-14 rounded-xl bg-gray-200 animate-pulse"})),64))])],64))}}),W={class:"flex gap-3 mb-8"},T=["onClick"],L=j({__name:"NotificationSelector",props:{frequencies:{}},emits:["selected-frequency"],setup(i,{emit:e}){const n=$(),t=v(()=>n.getUserPreferences),s=i,b=e,r=_(null);return U(()=>{t.value&&(r.value=t.value.notification_frequency)}),C(t,()=>{t.value&&(r.value=t.value.notification_frequency)}),(y,u)=>(g(),h(x,null,[u[0]||(u[0]=c("h2",{class:"text-2xl font-semibold text-[#2a3538] mb-4 font-montserrat"}," Notifications per day ",-1)),c("div",W,[(g(!0),h(x,null,P(s.frequencies,a=>(g(),h("button",{key:a,class:B(["flex-1 py-2 px-4 border-2 border-gray-400 rounded-xl hover:bg-gray-50 transition-colors text-xl",{"border-gray-700 bg-gray-200":l(r)===a}]),onClick:f=>{r.value=a,b("selected-frequency",a)}},w(a>1?`${a} times`:"1 time"),11,T))),128))])],64))}}),K="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2048%2048'%3e%3cpath%20fill='%23FFC107'%20d='M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z'/%3e%3cpath%20fill='%23FF3D00'%20d='M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z'/%3e%3cpath%20fill='%234CAF50'%20d='M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z'/%3e%3cpath%20fill='%231976D2'%20d='M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z'/%3e%3c/svg%3e",J=()=>{const i=S();return{user:q(),signInWithGoogle:async()=>{try{const{error:s}=await i.auth.signInWithOAuth({provider:"google",options:{queryParams:{access_type:"offline",prompt:"consent"},redirectTo:`${window.location.origin}/`}});if(s)throw s}catch(s){throw s instanceof Error?console.error("Error:",s.message):console.error("Error:",String(s)),s}},signOut:async()=>{try{const{error:s}=await i.auth.signOut();if(s)throw s}catch(s){throw s instanceof Error?console.error("Error:",s.message):console.error("Error:",String(s)),s}}}},Q=j({__name:"GoogleSignIn",setup(i){const{signInWithGoogle:e}=J(),n=_(!1),t=async()=>{try{n.value=!0,await e()}catch(s){console.error("Sign in error:",s)}finally{n.value=!1}};return(s,b)=>(g(),h("button",{class:"w-full mb-12 h-14 flex items-center justify-center gap-3 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",onClick:t},b[0]||(b[0]=[c("img",{src:K,alt:"Google",class:"w-10 h-10"},null,-1),c("span",{class:"text-3xl text-gray-700"},"Sign in with Google",-1)])))}}),R={class:"flex items-center justify-between mb-12"},X={class:"flex items-center gap-4"},Y=["src","alt"],Z={class:"text-lg font-medium text-gray-900"},ee={class:"text-sm text-gray-500"},te=j({__name:"UserProfile",setup(i){var b;const e=q(),n=S(),t=_((b=e.value)==null?void 0:b.user_metadata),s=async()=>{try{const{error:r}=await n.auth.signOut();if(r)throw r}catch(r){console.error("Error signing out:",r)}};return(r,y)=>{var u,a,f,p;return g(),h("div",R,[c("div",X,[c("img",{src:((u=l(t))==null?void 0:u.avatar_url)||"https://placehold.co/400x400",alt:((a=l(t))==null?void 0:a.full_name)||"User",class:"w-12 h-12 rounded-full object-cover",crossorigin:"anonymous",loading:"lazy",fetchpriority:"high",decoding:"async"},null,8,Y),c("div",null,[c("p",Z,w((f=l(t))==null?void 0:f.full_name),1),c("p",ee,w((p=l(t))==null?void 0:p.email),1)])]),c("button",{onClick:s,class:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",title:"Sign Out"},y[0]||(y[0]=[c("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[c("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),c("polyline",{points:"16 17 21 12 16 7"}),c("line",{x1:"21",y1:"12",x2:"9",y2:"12"})],-1)]))])}}}),se=G("subjects",{state:()=>({subjects:[],loading:!1,error:null}),actions:{async fetchSubjects(){const i=S();this.loading=!0;try{const{data:e,error:n}=await i.from("subjects").select("*");if(n)throw n;this.subjects=e}catch(e){this.error=e instanceof Error?e.message:"Unknown error",console.error("Error loading subjects:",e)}finally{this.loading=!1}}}}),re={class:"p-6 max-w-md mx-auto min-h-screen"},ne=["disabled"],oe={key:3,class:"w-full h-14 bg-[#5e9f95] text-white text-xl rounded-2xl hover:opacity-90 transition-opacity"},ae=j({__name:"index",setup(i){const e=_({subjects:null,frequencies:null}),n=se(),t=$(),s=v(()=>t.getUserPreferences),b=[1,2,3],r=q(),y=S(),u=_(!1),a=o=>{e.value.subjects===null&&(e.value.subjects={}),e.value.subjects[o.id]?delete e.value.subjects[o.id]:e.value.subjects[o.id]=!0},f=v(()=>{var o,d,m;return((o=t.getUserPreferences)==null?void 0:o.subjects.length)===0?"Subscribe to push notifications":p.value?"Update subjects":(d=t.getUserPreferences)!=null&&d.notification_frequency&&e.value.frequencies!==((m=t.getUserPreferences)==null?void 0:m.notification_frequency)?"Update frequency":"Go to questions"}),p=v(()=>{const o=t.getUserPreferences;if(!o||!e.value.subjects)return!1;const d=new Set(Object.keys(e.value.subjects)),m=new Set(o.subjects);return d.size!==m.size||[...d].some(k=>!m.has(k))}),E=v(()=>{const o=t.getUserPreferences;return!o||!e.value.frequencies?!1:e.value.frequencies!==o.notification_frequency}),M=()=>{s.value&&s.value.subjects&&(e.value.subjects=s.value.subjects.reduce((o,d)=>(o[d]=!0,o),{}),e.value.frequencies=s.value.notification_frequency)};U(async()=>{await n.fetchSubjects(),M()});async function N(){if(r.value){u.value=!0;try{const{error:o}=await y.from("user_preferences").upsert({user_id:r.value.id,subjects:Object.keys(e.value.subjects||[]),notification_frequency:e.value.frequencies,updated_at:new Date().toISOString()});if(o)throw o;console.log("Preferences saved successfully"),t.fetchUserPreferences(r.value.id)}catch(o){console.error("Error saving preferences:",o)}finally{u.value=!1}}}return C(r,()=>{console.log("User changed:",r.value),r.value&&(console.log("Fetching user preferences"),t.fetchUserPreferences(r.value.id))},{immediate:!0}),(o,d)=>{var F;const m=V,k=L;return g(),h("div",re,[d[1]||(d[1]=c("h1",{class:"text-4xl font-bold text-gray-900 mb-2"},"Tutor App",-1)),d[2]||(d[2]=c("h2",{class:"text-3xl text-gray-800 mb-8"},"Welcome!",-1)),l(r)?(g(),O(te,{key:0})):(g(),O(Q,{key:1})),z(m,{subjects:l(n).subjects,onToggleSubject:a},null,8,["subjects"]),z(k,{frequencies:b,onSelectedFrequency:d[0]||(d[0]=A=>l(e).frequencies=A)}),l(p)||l(E)||((F=l(t).getUserPreferences)==null?void 0:F.subjects.length)===0?(g(),h("button",{key:2,class:"w-full h-14 bg-[#5e9f95] text-white text-xl rounded-2xl hover:opacity-90 transition-opacity",onClick:N,disabled:!l(r)||l(u)},w(l(u)?"Saving...":l(f)),9,ne)):(g(),h("button",oe," Go to questions "))])}}});export{ae as default};
